<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Luxury Jewellery Showcase</title>

  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>

  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: 'Times New Roman', serif;
      background: #000;
    }

    /* HEADER */
    #header {
      position: absolute;
      top: 30px;
      width: 100%;
      text-align: center;
      z-index: 10;
      pointer-events: none;
    }

    #header h1 {
      color: #d4af37;
      letter-spacing: 6px;
      font-size: 2.5rem;
      margin: 0;
    }

    #header p {
      color: rgba(212,175,55,0.7);
      font-size: 0.9rem;
      letter-spacing: 2px;
      margin-top: 6px;
    }

    /* FOOTER */
    #footer {
      position: absolute;
      bottom: 30px;
      width: 100%;
      text-align: center;
      z-index: 10;
      pointer-events: none;
    }

    #footer span {
      color: rgba(255,255,255,0.6);
      font-size: 0.75rem;
      letter-spacing: 2px;
    }

    /* CLOSE BUTTON (ADDED) */
    #closeBtn {
      position: absolute;
      bottom: 90px;
      left: 50%;
      transform: translateX(-50%);
      padding: 10px 26px;
      border: 1px solid #d4af37;
      background: rgba(0,0,0,0.8);
      color: #d4af37;
      letter-spacing: 2px;
      cursor: pointer;
      display: none;
      z-index: 10;
    }
  </style>

  <script>
    /* =========================
       SYSTEM: State Manager
    ========================= */
    AFRAME.registerSystem('ring-state', {
      init() {
        this.busy = false;
        this.active = null;
        this.closeBtn = document.getElementById('closeBtn');

        this.closeBtn.onclick = () => {
          if (!this.active) return;
          this.active.emit('return');
          this.closeBtn.style.display = 'none';
          this.busy = false;
          this.active = null;
        };
      },

      request(el) {
        if (this.busy) return false;
        this.busy = true;
        this.active = el;
        this.closeBtn.style.display = 'block';
        return true;
      }
    });

    /* =========================
       COMPONENT: Ring Focus
    ========================= */
    AFRAME.registerComponent('ring-focus', {
      init() {
        this.system = this.el.sceneEl.systems['ring-state'];

        this.homePos = Object.assign({}, this.el.getAttribute('position'));
        this.homeScale = Object.assign({}, this.el.getAttribute('scale'));
        this.homeRot = Object.assign({}, this.el.getAttribute('rotation'));

        this.el.addEventListener('click', () => {
          if (!this.system.request(this.el)) return;

          this.el.setAttribute('animation__pos', {
            property: 'position',
            to: '0 1.6 2',
            dur: 900,
            easing: 'easeInOutQuad'
          });

          this.el.setAttribute('animation__scale', {
            property: 'scale',
            to: '1.5 1.5 1.5',
            dur: 900,
            easing: 'easeInOutQuad'
          });

          this.el.setAttribute('drag-rotate', '');
        });

        this.el.addEventListener('return', () => {
          this.el.removeAttribute('drag-rotate');

          const r = this.el.object3D.rotation;
          this.el.setAttribute('rotation', {
            x: THREE.MathUtils.radToDeg(r.x),
            y: THREE.MathUtils.radToDeg(r.y),
            z: THREE.MathUtils.radToDeg(r.z)
          });

          this.el.setAttribute('animation__pos', {
            property: 'position',
            to: this.homePos,
            dur: 800,
            easing: 'easeInOutQuad'
          });

          this.el.setAttribute('animation__scale', {
            property: 'scale',
            to: this.homeScale,
            dur: 800,
            easing: 'easeInOutQuad'
          });

          this.el.setAttribute('animation__rot_home', {
            property: 'rotation',
            to: this.homeRot,
            dur: 800,
            easing: 'easeInOutQuad'
          });
        });
      }
    });

    /* =========================
       COMPONENT: Drag Rotate
    ========================= */
    AFRAME.registerComponent('drag-rotate', {
      init() {
        this.dragging = false;
        this.startX = 0;
        this.startRot = 0;

        this.onDown = e => {
          this.dragging = true;
          this.startX = e.clientX || e.touches[0].clientX;
          this.startRot = this.el.object3D.rotation.y;
        };

        this.onMove = e => {
          if (!this.dragging) return;
          const x = e.clientX || e.touches[0].clientX;
          this.el.object3D.rotation.y =
            this.startRot + (x - this.startX) * 0.01;
        };

        this.onUp = () => this.dragging = false;

        window.addEventListener('mousedown', this.onDown);
        window.addEventListener('mousemove', this.onMove);
        window.addEventListener('mouseup', this.onUp);

        window.addEventListener('touchstart', this.onDown);
        window.addEventListener('touchmove', this.onMove);
        window.addEventListener('touchend', this.onUp);
      },

      remove() {
        window.removeEventListener('mousedown', this.onDown);
        window.removeEventListener('mousemove', this.onMove);
        window.removeEventListener('mouseup', this.onUp);

        window.removeEventListener('touchstart', this.onDown);
        window.removeEventListener('touchmove', this.onMove);
        window.removeEventListener('touchend', this.onUp);
      }
    });
  </script>
</head>

<body>

<div id="header">
  <h1>JEWELLERâ€™S</h1>
  <p>Click a ring to inspect craftsmanship</p>
</div>

<div id="footer">
  <span>Interactive 3D Product Experience</span>
</div>

<button id="closeBtn">RETURN</button>

<a-scene background="color: #111" cursor="rayOrigin: mouse" renderer="colorManagement: true; physicallyCorrectLights: true; antialias: true">

  <a-assets>
    <a-mixin id="gold-material" material="color: #FFD700; metalness: 1.0; roughness: 0.15;"></a-mixin>
    <a-mixin id="silver-material" material="color: #C0C0C0; metalness: 1.0; roughness: 0.15;"></a-mixin>
    <a-mixin id="diamond-material" material="color: #F0F8FF; metalness: 0.9; roughness: 0.0; opacity: 0.5; transparent: true; side: double;"></a-mixin>
  </a-assets>

  <a-entity camera position="0 1.6 4"></a-entity>

  <a-light type="ambient" intensity="0.7"></a-light>
  <a-light type="directional" position="2 4 3" intensity="1.5"></a-light>
  <a-light type="point" position="-2 3 2" intensity="1"></a-light>

  <a-box position="0 0.5 0" width="4" height="0.15" depth="2"
         material="color: #1a1a1a; roughness: 0.8"></a-box>

  <!-- RING 1 -->
  <a-entity position="-1 1 0" ring-focus>
    <a-entity rotation="0 45 0">
      <a-entity geometry="primitive: torus; radius: 0.22; radiusTubular: 0.012; arc: 360" mixin="gold-material"></a-entity>
      <a-entity position="0 0.22 0">
         <a-entity geometry="primitive: cylinder; radius: 0.003; height: 0.06" mixin="gold-material" position="0.03 0.02 0.03" rotation="0 0 -15"></a-entity>
         <a-entity geometry="primitive: cylinder; radius: 0.003; height: 0.06" mixin="gold-material" position="-0.03 0.02 0.03" rotation="0 0 15"></a-entity>
         <a-entity geometry="primitive: cylinder; radius: 0.003; height: 0.06" mixin="gold-material" position="0.03 0.02 -0.03" rotation="15 0 0"></a-entity>
         <a-entity geometry="primitive: cylinder; radius: 0.003; height: 0.06" mixin="gold-material" position="-0.03 0.02 -0.03" rotation="-15 0 0"></a-entity>
         <a-entity geometry="primitive: cone; radiusTop: 0.055; radiusBottom: 0.002; height: 0.05" mixin="diamond-material" position="0 -0.01 0"></a-entity>
         <a-entity geometry="primitive: cone; radiusTop: 0.03; radiusBottom: 0.055; height: 0.02" mixin="diamond-material" position="0 0.025 0"></a-entity>
      </a-entity>
    </a-entity>
  </a-entity>

  <!-- RING 2 -->
  <a-entity position="0 1 0" ring-focus>
    <a-entity geometry="primitive: torus; radius: 0.25; radiusTubular: 0.05" mixin="silver-material"></a-entity>
  </a-entity>

  <!-- RING 3 -->
  <a-entity position="1 1 0" ring-focus>
    <a-entity geometry="primitive: torusKnot; radius: 0.22; radiusTubular: 0.025; p: 3; q: 4"
              material="color: #B76E79; metalness: 0.9; roughness: 0.2"
              rotation="0 -30 0"></a-entity>
  </a-entity>

  <a-sky color="#111"></a-sky>
</a-scene>

</body>
</html>
